var k=Object.defineProperty,g=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var m=(t,e,s)=>e in t?k(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,h=(t,e)=>{for(var s in e||(e={}))D.call(e,s)&&m(t,s,e[s]);if(p)for(var s of p(e))F.call(e,s)&&m(t,s,e[s]);return t},y=(t,e)=>g(t,w(e));var n=(t,e,s)=>new Promise((a,r)=>{var c=o=>{try{u(s.next(o))}catch(f){r(f)}},d=o=>{try{u(s.throw(o))}catch(f){r(f)}},u=o=>o.done?a(o.value):Promise.resolve(o.value).then(c,d);u((s=s.apply(t,e)).next())});import{_ as b,A as v,l as S,e as _,o as V,f as T,m as l,g as i,w as R}from"./vendor.499e631e.js";import{d as U,s as E}from"./index.113d3161.js";const C={components:{Autocomplete:v,TextInput:S},data(){return{fuelUsedData:{date:"",fuel_tanker:"",site:"",reg_no:"",resource_type:"",make:"",type:"",resource:""},isSubmitting:!1,tankers:[],sites:[],resources:[]}},mounted(){this.fetchFuelTankerOptions(),this.fetchSiteOptions(),this.fetchResources(),window.addEventListener("online",()=>n(this,null,function*(){alert("Internet connection restored, attempting to sync offline data..."),console.log("Back online, syncing submissions...");const t=yield U.fuelUsed.toArray();if(t.length>0){for(const e of t)try{(yield fetch("/api/resource/Fuel Used",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({data:e})})).ok?(console.log("Submission synced successfully",e),yield U.fuelUsed.delete(e.id)):console.error("Failed to sync submission",e)}catch(s){console.error("Error syncing submission",e,s)}alert("All offline data has been synced."),this.resetForm()}else console.log("No offline data to sync.")}))},watch:{"fuelUsedData.resource":{immediate:!0,handler(t){return n(this,null,function*(){t&&t.value?yield this.fetchResourceDetails(t.value):this.clearRelatedFields()})}}},methods:{fetchFuelTankerOptions(){return n(this,null,function*(){const t="/api/method/fuel_tracker.api.get_fuel_tanker_options";try{const e=yield fetch(t,{headers:{"X-Frappe-CSRF-Token":window.csrf_token}});if(!e.ok)throw new Error(`Failed to fetch fuel tanker options: ${e.statusText}`);const s=yield e.json();this.tankers=s.message||[]}catch(e){console.error("Error fetching fuel tanker options:",e)}})},fetchSiteOptions(){return n(this,null,function*(){const t="/api/method/fuel_tracker.api.get_site_options";try{const e=yield fetch(t,{headers:{"X-Frappe-CSRF-Token":window.csrf_token}});if(!e.ok)throw new Error(`Failed to fetch site options: ${e.statusText}`);const s=yield e.json();this.sites=s.message||[]}catch(e){console.error("Error fetching site options:",e)}})},fetchResources(){return n(this,null,function*(){const t="/api/method/fuel_tracker.api.get_resources";try{const e=yield fetch(t,{headers:{"X-Frappe-CSRF-Token":window.csrf_token}});if(!e.ok)throw new Error("Failed to fetch resources");const s=yield e.json();this.resources=s.message||[]}catch(e){console.error("Error fetching resources:",e)}})},clearRelatedFields(){this.fuelUsedData.reg_no="",this.fuelUsedData.resource_type="",this.fuelUsedData.make="",this.fuelUsedData.type=""},fetchResourceDetails(t){return n(this,null,function*(){console.log(`Fetching details for: ${t}`);const e=`/api/method/fuel_tracker.api.get_resource_details?resource_name=${encodeURIComponent(t)}`;try{const s=yield fetch(e,{headers:{"X-Frappe-CSRF-Token":window.csrf_token}});if(!s.ok)throw new Error(`Failed to fetch details for the selected resource: ${s.statusText}`);const{message:a}=yield s.json();a&&a!=="No details found for the selected resource."?(this.fuelUsedData.reg_no=a.reg_no||"",this.fuelUsedData.resource_type=a.resource_type||"",this.fuelUsedData.make=a.make||"",this.fuelUsedData.type=a.type||""):this.clearRelatedFields()}catch(s){console.error(`Error fetching details for the selected resource: ${s}`),this.clearRelatedFields()}})},submitFuelUsed(){return n(this,null,function*(){var e,s;this.isSubmitting=!0;let t=y(h({},this.fuelUsedData),{fuel_tanker:(e=this.fuelUsedData.fuel_tanker)==null?void 0:e.value,site:JSON.stringify(this.fuelUsedData.site),resource:(s=this.fuelUsedData.resource)==null?void 0:s.value});try{if(!navigator.onLine)console.log("Offline, attempting to save submission:",t),yield E(t),alert("You are offline. Data has been saved locally and will sync when you are back online."),this.resetForm();else{if(!(yield fetch("/api/resource/Fuel Used",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({data:t})})).ok)throw new Error("Failed to save Fuel Used.");alert("Fuel Used saved successfully."),this.resetForm()}}catch(a){console.error("Error:",a),alert(`Error: ${a.message}`)}finally{this.isSubmitting=!1}})},resetForm(){this.fuelUsedData={date:"",fuel_tanker:"",site:"",reg_no:"",resource_type:"",make:"",type:"",resource:""}},preventDefault(){}}},O={class:"fuel-used-form"},x=l("h2",null,"Enter Details for Fuel Used",-1),j={class:"p-2"},N={class:"p-2"},A={class:"p-2"},X={class:"p-2"},I={class:"p-2"},B={class:"p-2"},J={class:"p-2"},M={class:"p-2"},L={class:"p-4"},P=["disabled"];function z(t,e,s,a,r,c){const d=_("TextInput"),u=_("Autocomplete");return V(),T("div",O,[x,l("form",{onSubmit:e[9]||(e[9]=R((...o)=>c.preventDefault&&c.preventDefault(...o),["prevent"]))},[l("div",j,[i(d,{modelValue:r.fuelUsedData.date,"onUpdate:modelValue":e[0]||(e[0]=o=>r.fuelUsedData.date=o),type:"date",size:"sm",variant:"subtle",placeholder:"Select Date",disabled:!1},null,8,["modelValue"])]),l("div",N,[i(u,{options:r.tankers,modelValue:r.fuelUsedData.fuel_tanker,"onUpdate:modelValue":e[1]||(e[1]=o=>r.fuelUsedData.fuel_tanker=o),placeholder:"Select Fuel Tanker"},null,8,["options","modelValue"])]),l("div",A,[i(u,{options:r.sites,modelValue:r.fuelUsedData.site,"onUpdate:modelValue":e[2]||(e[2]=o=>r.fuelUsedData.site=o),placeholder:"Select Site"},null,8,["options","modelValue"])]),l("div",X,[i(u,{options:r.resources,modelValue:r.fuelUsedData.resource,"onUpdate:modelValue":e[3]||(e[3]=o=>r.fuelUsedData.resource=o),placeholder:"Select Resource"},null,8,["options","modelValue"])]),l("div",I,[i(d,{modelValue:r.fuelUsedData.reg_no,"onUpdate:modelValue":e[4]||(e[4]=o=>r.fuelUsedData.reg_no=o),label:"Registration Number",placeholder:"Registration Number",readonly:""},null,8,["modelValue"])]),l("div",B,[i(d,{modelValue:r.fuelUsedData.resource_type,"onUpdate:modelValue":e[5]||(e[5]=o=>r.fuelUsedData.resource_type=o),label:"Resource Type",placeholder:"Resource Type",readonly:""},null,8,["modelValue"])]),l("div",J,[i(d,{modelValue:r.fuelUsedData.make,"onUpdate:modelValue":e[6]||(e[6]=o=>r.fuelUsedData.make=o),label:"Make",placeholder:"Make",readonly:""},null,8,["modelValue"])]),l("div",M,[i(d,{modelValue:r.fuelUsedData.type,"onUpdate:modelValue":e[7]||(e[7]=o=>r.fuelUsedData.type=o),label:"Type",placeholder:"Type",readonly:""},null,8,["modelValue"])]),l("div",L,[l("button",{type:"button",onClick:e[8]||(e[8]=(...o)=>c.submitFuelUsed&&c.submitFuelUsed(...o)),disabled:r.isSubmitting}," Submit ",8,P)])],32)])}var G=b(C,[["render",z]]);export{G as default};
