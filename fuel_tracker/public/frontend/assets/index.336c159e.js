var p=(e,o,t)=>new Promise((s,r)=>{var n=a=>{try{l(t.next(a))}catch(m){r(m)}},i=a=>{try{l(t.throw(a))}catch(m){r(m)}},l=a=>a.done?s(a.value):Promise.resolve(a.value).then(n,i);l((t=t.apply(e,o)).next())});import{c as g,r as L,a as k,b as E,d as w,_ as P,e as b,o as I,f as O,g as R,h as S,s as U,i as C,j,C as A,I as W,D as $,k as D}from"./vendor.499e631e.js";const F=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}};F();const x="modulepreload",v={},B="/assets/fuel_tracker/frontend/",y=function(o,t){return!t||t.length===0?o():Promise.all(t.map(s=>{if(s=`${B}${s}`,s in v)return;v[s]=!0;const r=s.endsWith(".css"),n=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${n}`))return;const i=document.createElement("link");if(i.rel=r?"stylesheet":x,r||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),r)return new Promise((l,a)=>{i.addEventListener("load",l),i.addEventListener("error",a)})})).then(()=>o())},_=g({url:"frappe.auth.get_logged_user",cache:"User",onError(e){e&&e.exc_type==="AuthenticationError"&&d.push({name:"LoginPage"})}});function h(){let o=new URLSearchParams(document.cookie.split("; ").join("&")).get("user_id");return o==="Guest"&&(o=null),o}const u=L({login:g({url:"login",makeParams({email:e,password:o}){return{usr:e,pwd:o}},onSuccess(e){_.reload(),u.user=h(),u.login.reset(),d.replace(e.default_route||"/")}}),logout:g({url:"logout",onSuccess(){_.reset(),u.user=h(),d.replace({name:"Login"})}}),user:h(),isLoggedIn:k(()=>!!u.user)}),H=[{path:"/",name:"Home",component:()=>y(()=>import("./Home.4baef662.js"),["assets/Home.4baef662.js","assets/vendor.499e631e.js","assets/vendor.1875b906.css"])},{name:"Login",path:"/account/login",component:()=>y(()=>import("./Login.3f3fbb3d.js"),["assets/Login.3f3fbb3d.js","assets/vendor.499e631e.js","assets/vendor.1875b906.css"])}];let d=E({history:w("/frontend"),routes:H});d.beforeEach((e,o,t)=>p(void 0,null,function*(){let s=u.isLoggedIn;try{yield _.promise}catch(r){s=!1}e.name==="Login"&&s?t({name:"Home"}):e.name!=="Login"&&!s?t({name:"Login"}):t()}));const N={};function q(e,o){const t=b("router-view");return I(),O("div",null,[R(t)])}var T=P(N,[["render",q]]);let c=S(T);U("resourceFetcher",D);c.use(d);c.use(C);c.component("Button",j);c.component("Card",A);c.component("Input",W);c.mount("#app");"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/assets/fuel_tracker/frontend/sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})});const f=new $("FuelTrackerDB");f.version(1).stores({fuelUsed:"++id, date, fuel_tanker, site, reg_no, resource_type, make, type, resource"});function K(e){return p(this,null,function*(){f.fuelUsed.add(e).then(()=>{console.log("Fuel used saved for syncing")})})}window.addEventListener("online",()=>{f.fuelUsed.each(e=>{console.log(e),f.fuelUsed.delete(e.id)})});export{u as a,f as d,K as s};
